<!DOCTYPE html>
<html>
<head>
    <title>Currently Playing</title>
</head>
<body>
    <h1>Currently Playing on Spotify:</h1>
    <div id="currently-playing">
        <p>Album Name: <span id="album-name"></span></p>
        <p>Artist Name: <span id="artist-name"></span></p>
    </div>

    <script>
      // Function to extract the access token from the URL
      function getAccessToken() {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get("code");

          if(code) {
            const tokenEndpoint = "https://account.spotify.com/api/token";
            const client_secret = "2d5a82decbc240e4adadcbd86f342321";
            const basicAuthHeader = (`e9fec6e1cb5241e0a41ab98db146bc3c:${client_secret}`);

            const data = {
                grant_type: "authorization_code",
                code: code,
                redirect_uri: redirect_uri,
            };

            fetch(tokenEndpoint, {
                method: "POST",
                headers: {
                    "Authorization": `Basic ${basicAuthHeader}`,
                    "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams(data),
            })

            .then((response) => response.json())
            .then((tokenData) => {
                const access_token = tokenData.access_token;
                //Use the access token to get the user's data
                fetch("https://api.spotify.com/v1/me", {
                     headers: {
                           "Authorization": `Bearer ${access_token}`,
                     },
                })
                return access_token;
            })

          }
      }

      // Fetch data from Spotify API
      async function getCurrentlyPlaying() {
          const accessToken = getAccessToken();

          if (accessToken) {
              const response = await fetch('https://api.spotify.com/v1/me/player/currently-playing', {
                  method: 'GET',
                  headers: {
                      'Authorization': `Bearer ${accessToken}`,
                  },
              });

              if (response.status === 200) {
                  const data = await response.json();
                  document.getElementById('album-name').textContent = data.item.album.name;
                  document.getElementById('artist-name').textContent = data.item.artists[0].name;
              } else {
                  document.getElementById('currently-playing').textContent = 'Not currently playing anything on Spotify.';
              }
          } else {
              document.getElementById('currently-playing').textContent = 'Access token not found.';
          }
      }

      getCurrentlyPlaying();
    </script>
</body>
</html>
