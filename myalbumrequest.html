<!DOCTYPE html>
<html>
<head>
    <title>Currently Playing</title>
</head>
<body>
    <h1>Currently Playing on Spotify:</h1>
    <div id="currently-playing">
        <p>Album Name: <span id="album-name"></span></p>
        <p>Artist Name: <span id="artist-name"></span></p>
        <img id="album-cover" src="" alt="Album Cover">
        <p id="myusername"></p>
        <img id="profilepicture" src="" alt="Profile Picture">
    </div>

    <script>
    // Function to get the user's display name and profile picture
    async function getUserProfile(accessToken) {
        const response = await fetch('https://api.spotify.com/v1/me', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
            },
        });

        if (response.status === 200) {
            const data = await response.json();
            const displayName = data.display_name;
            const profilePictureUrl = data.images.length > 0 ? data.images[0].url : '';

            document.getElementById('myusername').textContent = `My Username: ${displayName}`;
            document.getElementById('profilepicture').src = profilePictureUrl;
            document.getElementById('profilepicture').alt = `${displayName}'s Profile Picture`;
        } else {
            document.getElementById('myusername').textContent = 'Unable to fetch username';
        }
    }

    // Function to get currently playing track and display it
    async function getCurrentlyPlaying() {
        const accessToken = await getAccessToken();

        if (accessToken) {
            // Fetch currently playing track
            const response = await fetch('https://api.spotify.com/v1/me/player/currently-playing', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                },
            });

            if (response.status === 200) {
                const data = await response.json();
                const albumName = data.item.album.name;
                const artistName = data.item.artists[0].name;
                const albumCoverUrl = data.item.album.images[0].url; // Assuming you want the first image in the album

                document.getElementById('album-name').textContent = albumName;
                document.getElementById('artist-name').textContent = artistName;

                const albumCoverElement = document.getElementById('album-cover');
                albumCoverElement.src = albumCoverUrl;
                albumCoverElement.alt = `${albumName} Album Cover`;

                // Fetch and display the user's display name and profile picture
                getUserProfile(accessToken);
            } else {
                document.getElementById('currently-playing').textContent = 'Not currently playing anything on Spotify.';
            }
        }
    }

    // Call the getCurrentlyPlaying function
    getCurrentlyPlaying();
    </script>
</body>
</html>

